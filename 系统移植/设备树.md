### 一、基本概念（初步认识）

>  *1.1 设备树是什么？包含哪些部分？*

（1）device tree，是一种数据结构，是==Linux内核中采用的参数表示和传递技术；==

（2）device tree source (dts)，设备树源文件，包括外设的物理地址范围、中断信息、属性等；

（3）device tree compiler (dtc)，设备树编译/反编译/调试工具；

  (4)  device tree blob (dtb)， 二进制设备树镜像；

> *1.2 为什么需要设备树？*

（1）内核设备驱动需要；设备树可以让操作系统知道系统中有哪些设备，它们的==地址范围（可查CPU芯片手册，相关寄存器已经进行了地址映射）==、中断信息、属性等，从而方		 便驱动程序的开发和系统的配置；

（2）避免内核源码中充斥大量描述具体硬件信息的文件（污染内核）；

> *1.3 设备树技术如何工作？*

（1）驱动开发者编写/改写dts，适配硬件和自己的需求；

（2）make Image时，kernel 内部会先编译出dtc，然后用dtc将dts加工为dtb ；

（3）uboot 启动kernel 时，将Image和dtb都准备好，并告知Image在哪里找dtb；

（4）kernel 启动初期调用内部函数解析dtb，得到硬件信息，并组装成数据结构。



>  补充

- 设备树的编译和传递
  - 设备树源文件（DTS）会经过编译生成设备树二进制文件（DTB）。在系统启动时，引导程序（如 U-Boot）会将 DTB 文件加载到内存中，并将其地址传递给内核。
  - 内核在启动时会解析 DTB 文件，对于每个外设节点，会读取 `reg` 属性来获取外设的地址信息。通过解析设备树，内核可以知道系统中有哪些外设，它们的地址范围，从而可以对这些外设进行配置和驱动程序的加载。
- 硬件设计和文档支持
  - 硬件设计人员在设计硬件时，会有详细的硬件规格和文档，这些文档会明确每个外设的物理地址和寄存器布局。根据这些信息，在编写设备树源文件时，会将相应的地址信息添加到设备树中。
  - 对于一些复杂的系统，可能会有专门的工具或脚本，根据硬件设计文件自动生成部分设备树信息，确保设备树中描述的外设地址信息与实际的硬件地址信息一致。

