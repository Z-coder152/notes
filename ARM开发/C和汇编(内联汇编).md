

### C语言中嵌入汇编代码：（aarch64-linux）



```c

#include <stdio.h>

// 定义 C 函数 Sum
int Sum(int a, int b)
{
    int out = a + b;
    printf("result = %d\n", out);
    return out;
}

int main(void)
{
    int result; // 用于存储 Sum 函数的返回值

    // 使用内联汇编调用 Sum 函数
    __asm__(
        "MOV x0, %1\n\t"       // 将第一个参数加载到 x0
        "MOV x1, %2\n\t"       // 将第二个参数加载到 x1
        "BL Sum\n\t"           // 调用 Sum 函数
        "MOV %0, x0\n\t"       // 将返回值从 x0 移动到 result
        : "=r" (result)        // 输出约束，result 存储返回值
        : "r" (2), "r" (3)     // 输入约束，将 2 和 3 作为参数传递
        : "x0", "x1"           // 被修改的寄存器
    );

    // 打印结束信息
    printf("hahaha, this is end\n");

    return 0;
}
```



### 内联汇编的一般格式如下：



```c
__asm__ (
    "汇编代码\n\t"      // 汇编指令
    : 输出操作数         // 定义输出
    : 输入操作数         // 定义输入
    : 被修改的寄存器或内存 // 定义可能被修改的寄存器或内存
);
```

### 示例解释

- **汇编代码**：写入实际的汇编指令，使用 `%0`, `%1` 引用操作数。
- **输出操作数**（`:` 后的第一部分）：指定输出变量的约束和存储位置。
- **输入操作数**（`:` 后的第二部分）：指定输入变量的约束和来源。
- **被修改部分**（`:` 后的第三部分）：列出可能被修改的寄存器或内存。

### 示例代码

```c
int result;
__asm__ (
    "MOV x0, %1\n\t"
    "MOV x1, %2\n\t"
    "ADD x0, x0, x1\n\t"
    "MOV %0, x0\n\t"
    : "=r" (result)        // 输出到 result
    : "r" (2), "r" (3)     // 输入 2 和 3
    : "x0", "x1"           // 修改了寄存器 x0 和 x1
);
```